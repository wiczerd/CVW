#sets up the crosswalks for industry codes into 2-digit codes


library(foreign)
library(zoo)
library(data.table)

# eventually move data files to master directory
wd0 = "~/workspace/CVW/R"
xwalkdir = "~/workspace/CVW/R/Crosswalks"
setwd(wd0)

CIC2000_2_CIC1990 <- data.table(read.csv(paste0(xwalkdir,"/IndCIC_2000_1990.csv")))
CIC2002_2_CIC2000 <- data.table(read.csv(paste0(xwalkdir,"/IndCIC_2000_2002.csv")))

CIC2000_2_CIC1990[, CIC1990 := na.locf(CIC1990, na.rm=F)]
CIC2000_2_CIC1990<-CIC2000_2_CIC1990[!is.na(CIC2000), ]
CIC2000_2_CIC1990[ , prob1990:= COUNT/sum(COUNT), by = CIC2000]


# from CEPR codes
CIC2000_2_CIC1990[CIC1990>=10 & CIC1990<=31, ind23 := 1]
CIC2000_2_CIC1990[CIC1990>=40 & CIC1990<50,  ind23 := 2]
CIC2000_2_CIC1990[CIC1990==60, ind23 := 3]
CIC2000_2_CIC1990[CIC1990>=100 & CIC1990<=222, ind23 := 5]
CIC2000_2_CIC1990[CIC1990>=230 & CIC1990<=392, ind23 := 4]
CIC2000_2_CIC1990[CIC1990>=400 & CIC1990<=432, ind23 := 6]
CIC2000_2_CIC1990[CIC1990>=440 & CIC1990<=442, ind23 := 7]
CIC2000_2_CIC1990[CIC1990>=450 & CIC1990<=472, ind23 := 8]
CIC2000_2_CIC1990[CIC1990>=500 & CIC1990<=571, ind23 := 9]
CIC2000_2_CIC1990[CIC1990>=580 & CIC1990<=691, ind23 := 10]
CIC2000_2_CIC1990[CIC1990>=700 & CIC1990<=712, ind23 := 11]
CIC2000_2_CIC1990[CIC1990==761, ind23 := 12]
CIC2000_2_CIC1990[CIC1990>=721 & CIC1990<=760, ind23 := 13]
CIC2000_2_CIC1990[CIC1990>=762 & CIC1990<=791, ind23 := 14]
CIC2000_2_CIC1990[CIC1990>=800 & CIC1990<=810, ind23 := 15]
CIC2000_2_CIC1990[CIC1990==831, ind23 := 16]
CIC2000_2_CIC1990[CIC1990>=812 & CIC1990<=840 & CIC1990!=831, ind23 := 17]
CIC2000_2_CIC1990[CIC1990>=842 & CIC1990<=860, ind23 := 18]
CIC2000_2_CIC1990[CIC1990>=861 & CIC1990<=871, ind23 := 19]
CIC2000_2_CIC1990[CIC1990==841 | (CIC1990>=872 & CIC1990<=893) , ind23 := 20]
CIC2000_2_CIC1990[CIC1990>=31 & CIC1990<=32 , ind23 := 21 ]
CIC2000_2_CIC1990[CIC1990>=900 & CIC1990<=932, ind23 := 22] 
CIC2000_2_CIC1990[CIC1990==991, ind23 := 23]

CIC2000_2_CIC1990[, NoMatch:= length(unique(ind23)), by = CIC2000]
CIC2000_2_CIC1990[, maxprob := max(prob1990), by = CIC2000]
CIC2000_2_CIC1990 <- CIC2000_2_CIC1990[ prob1990>= maxprob, ]

CIC2000_2_CIC1990[, ind:= as.integer(CIC2000)]
CIC2000_2_CIC1990[, ind23:= as.integer(ind23)]
CIC2002_2_CIC2000[, ind:= as.integer(CIC2002)]
CIC2002_2_CIC2000[, CIC2000:= as.integer(CIC2000)]

setkey(CIC2002_2_CIC2000,ind)
setkey(CIC2000_2_CIC1990,ind)

CIC2002_2_CIC2000<- subset(CIC2002_2_CIC2000, select=c("ind","CIC2000"))
CIC2000_2_CIC1990<- subset(CIC2000_2_CIC1990, select=c("ind","ind23"))

saveRDS(CIC2002_2_CIC2000,paste0(xwalkdir,"/CIC2002_2_CIC2000.RData"))
saveRDS(CIC2000_2_CIC1990,paste0(xwalkdir,"/CIC2000_2_CIC1990.RData"))
